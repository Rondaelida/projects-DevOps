## Part 1. Инструмент ipcalc
#### 1.1. Сети и маски
- установка ipcalc 
    ![Alt text](./screen/1.png)

- определение адреса сети 
    ![Alt text](./screen/1.1.png)
    - адрес для сети 192.167.38.54/13: 192.160.0.0

- перевод маски 255.255.255.0
    ![Alt text](./screen/1.2.png)
    - в префиксную : /24
    - в двоичную : 11111111.11111111.11111111.00000000

- перевод маски /15
    ![Alt text](./screen/1.3.png)
    -  в обычную : 255.254.0.0
    - и двоичную : 11111111.11111110.00000000.00000000

- перевод маски 11111111.11111111.11111111.11110000
    ![Alt text](./screen/1.4.png)
    - в обычную : 255.255.255.240
    - в префиксную : /28

- хост в сети 12.167.38.4 при маске: /8
    ![Alt text](./screen/1.5.png)
    - минимальный хост : 12.0.0.1
    - максимальный хост : 12.255.255.254

- хост в сети 12.167.38.4 при маске: 11111111.11111111.00000000.00000000
    ![Alt text](./screen/1.6.png)
    - минимальный хост : 12.167.0.1
    - максимальный хост : 12.167.255.254

- хост в сети 12.167.38.4 при маске: 255.255.254.0
    ![Alt text](./screen/1.7.png)
    - минимальный хост : 12.167.38.1
    - максимальный хост :12.167.39.254

- хост в сети 12.167.38.4 при маске: /4
    ![Alt text](./screen/1.8.png)
    - минимальный хост : 0.0.0.1 
    - максимальный хост : 15.255.255.254

#### 1.2. localhost
- обращение к адресам 194.34.23.100, 127.0.0.2, 127.1.0.1
    ![Alt text](./screen/1.9.png)
- обращение к адресу 128.0.0.1
    ![Alt text](./screen/1.10.png)
- можно обратиться к адресам 127.0.0.2 и 127.1.0.1 т.к. есть loopback обратная петля, адрес того компьютера с которого отправлен запрос.
Имя localhost как правило присвоено именно этому адресу.

#### 1.3. Диапазоны и сегменты сетей
- Публичные: 134.43.0.2, 172.0.2.1, 192.172.0.1, 192.169.168.1
- Частные: 10.0.0.45, 10.10.10.10, 192.168.4.2, 172.20.250.4, 172.68.0.2, 172.16.255.255
- Из перечисленных IP адресов шлюза возможны у сети 10.10.0.0/18: 10.10.0.2, 10.10.10.10, 10.10.100.1, 10.10.1.255
---
## Part 2. Статическая маршрутизация между двумя машинами
- просмотр существующих сетевых интерфейсов ws-1
    ![Alt text](./screen/2.png)
- просмотр существующих сетевых интерфейсов ws-2
    ![Alt text](./screen/2.1.png)
- установка адерса и маски на ws-1 и перезапуск сервиса сети
    ![Alt text](./screen/2.2.png)
- установка адерса и маски на ws-2 и перезапуск сервиса сети
    ![Alt text](./screen/2.3.png)
- проверка сетевых интерфесов для ws1
    ![Alt text](./screen/2.4.png)
- проверка сетевых интерфесов для ws2
    ![Alt text](./screen/2.5.png)

#### 2.1. Добавление статического маршрута вручную
- ws1 добавление маршрута до машины ws2 и пинг 
    ![Alt text](./screen/2.6.png)
- ws2 добавление маршрута до машины ws1 и пинг
    ![Alt text](./screen/2.7.png)

#### 2.2. Добавление статического маршрута с сохранением
- перезапуск машин через `sudo reboot`
- Добавление статического маршрута от одной машины до другой ws1
    ![Alt text](./screen/2.8.png)
- Добавление статического маршрута от одной машины до другой ws2
    ![Alt text](./screen/2.9.png)
- Пропинговал соединение между машинами для ws1
    ![Alt text](./screen/2.10.png)
- Пропинговал соединение между машинами для ws2
    ![Alt text](./screen/2.11.png)
---
## Part 3. Утилита iperf3
#### 3.1. Скорость соединения
- 8 Mbps в MB/s - 1 MB/s 
- 100 MB/s в Kbps - 100000 Kbps
- 1 Gbps в Mbps - 1000 Mbps

#### 3.2. Утилита iperf3
- установка iperf3 с помощью команды `sudo apt install iperf3`
- используем вм как сервер 
![Alt text](./screen/3.1.png)
- Измерить скорость соединения между ws1 и ws2. 
 ![Alt text](./screen/3.png)
---
## Part 4. Сетевой экран
#### 4.1. Утилита iptables
- добавление в файл правил 1,2,3,4,5 для ws1
    ![Alt text](./screen/4.png)
- добавление в файл правил 1,2,3,4,5 для ws2
    ![Alt text](./screen/4.1.png)
- запуск команд `chmod +x /etc/firewall.sh` и `/etc/firewall.sh` для ws1
    ![Alt text](./screen/4.2.png)
- запуск команд `chmod +x /etc/firewall.sh` и `/etc/firewall.sh` для ws2
    ![Alt text](./screen/4.3.png)
- Разница: iptables выполняет правила последовательно, соответсвенно ws1 не будет пинговаться, т.к. сначала идёт запрещающее правило. ws2 будет, т.к. сначала идёт разрешающее правило.

#### 4.2. Утилита nmap
- пинг машины  которая не "пингуется" (ws1)
    ![Alt text](./screen/4.4.png)
- хост машины запущен
    ![Alt text](./screen/4.5.png)
- дампы образов виртуальных машин
    ![Alt text](./screen/4.6.png)
---
## Part 5. Статическая маршрутизация сети
#### 5.1. Настройка адресов машин
- настройка ws11
    ![Alt text](./screen/5.png)
- настройка r1
    ![Alt text](./screen/5.1.png)
- настройка r2
    ![Alt text](./screen/5.2.png)
- настройка ws21
    ![Alt text](./screen/5.3.png)
- настройка ws22
    ![Alt text](./screen/5.4.png)
- проверка ws11
    ![Alt text](./screen/5.5%20ws11.png)
- проверка r1
    ![Alt text](./screen/5.6%20r1.png)
- проверка r2
    ![Alt text](./screen/5.7%20r2.png)
- проверка ws21
    ![Alt text](./screen/5.8%20ws21.png)
- проверка ws22
   ![Alt text](./screen/5.9%20ws22.png)
- пинг ws22 через ws21
    ![Alt text](./screen/5.10%20.png)
- пинг r1 через ws11
    ![Alt text](./screen/5.11.png)

#### 5.2. Включение переадресации IP-адресов.
- выполнение команды `sysctl -w net.ipv4.ip_forward=1` на r1
    ![Alt text](./screen/5.12.png)
- выполнение команды `sysctl -w net.ipv4.ip_forward=1` на r2
    ![Alt text](./screen/5.13.png)
- изменение  `/etc/sysctl.conf` на r1
    ![Alt text](./screen/5.14.png)
- изменение  `/etc/sysctl.conf` на r1
    ![Alt text](./screen/5.15.png)

#### 5.3. Установка маршрута по-умолчанию
- Настроийка маршрута по-умолчанию для ws11
    ![Alt text](./screen/5.16.png)
- Настроийка маршрута по-умолчанию для ws21
    ![Alt text](./screen/5.17.png)
- Настроийка маршрута по-умолчанию для ws22
    ![Alt text](./screen/5.16.1.png)
- Вызов `ip r` для ws11
    ![Alt text](./screen/5.18.png)
- Вызов `ip r` для ws21
    ![Alt text](./screen/5.19.png)
- Вызов `ip r` для ws22
    ![Alt text](./screen/5.20.png)
- Пропинговали с ws11 роутер r2 
    ![Alt text](./screen/5.21.png)
- пинг доходит на r2
    ![Alt text](./screen/5.22.png)

#### 5.4. Добавление статических маршрутов
- Добавить в роутеры r1 и r2 статические маршруты в файле конфигураций.
- для r1 
    ![Alt text](./screen/5.40.png)
- для r2
    ![Alt text](./screen/5.41.png)
- Вызвать ip r и показать таблицы с маршрутами на обоих роутерах.
- для r1 
    ![Alt text](./screen/5.42.png)
- для r2
    ![Alt text](./screen/5.43.png)
- Запускаем команды на ws11: ip r list 10.10.0.0/[маска сети] 
    ![Alt text](./screen/5.44.png)
- и ip r list 0.0.0.0/0
    ![Alt text](./screen/5.45.png)
- Для локальной подсети 10.10.0.0/18 у нас отдельный маршрут, чтобы пакеты не отправлялись на все остальные адреса, входящие в 0.0.0.0/0

#### 5.5. Построение списка маршрутизаторов
- Запустить на r1 команду дампа `tcpdump -tnv -i eth0`
    ![Alt text](./screen/5.50.png)
- список маршрутизаторов на пути от ws11 до ws21
    ![Alt text](./screen/5.51.png)
- Команда traceroute linux использует UDP пакеты. Она отправляет пакет с TTL=1 и смотрит адрес ответившего узла, дальше TTL=2, TTL=3 и так пока не достигнет цели. Каждый раз отправляется по три пакета и для каждого из них измеряется время прохождения. Когда утилита traceroute получает сообщение от целевого узла о том, что порт недоступен трассировка считается завершенной.

#### 5.6. Использование протокола ICMP при маршрутизации
- Запустиkb на r1 перехват сетевого трафика,
    ![Alt text](./screen/5.60.png)
- Пропинговать с ws11 несуществующий IP
    ![Alt text](./screen/5.61.png)
---
## Part 6. Динамическая настройка IP с помощью DHCP
- указать адрес маршрутизатора по-умолчанию для r2:
    ![Alt text](./screen/6.png)
- в файле /etc/resolv.conf прописать `nameserver 8.8.8.8.`
    ![Alt text](./screen/6.1.png)
- Перезагружаем службу DHCP командой `systemctl restart isc-dhcp-server`
    ![Alt text](./screen/6.2.png)
- Через ip a показываем, что ws21 получила адрес:
    ![Alt text](./screen/6.3.png)
- Пингуем ws21 с ws22:
    ![Alt text](./screen/6.4.png)


- Указываем MAC адрес у ws11: `в etc/netplan/00-installer-config.yaml` добляем строки: `macaddress: 10:10:10:10:10:BA, dhcp4: true`
    ![Alt text](./screen/6.5.png)
- Для r1 настраиваем в файле /etc/dhcp/dhcpd.conf конфигурацию службы DHCP: указываем адрес маршрутизатора по-умолчанию, DNS-сервер и адрес внутренней сети:
    ![Alt text](./screen/6.6.png)
- в файле /etc/resolv.conf прописать nameserver 8.8.8.8.
    ![Alt text](./screen/6.7.png)
- Перезагружаем службу DHCP командой systemctl restart isc-dhcp-server
    ![Alt text](./screen/6.8.png)
- Через ip a показываем, что ws11 получила адрес:
    ![Alt text](./screen/6.9.png)
- Пингуем ws22 с ws11:
    ![Alt text](./screen/6.10.png)

- Через ip a показываем текущий адрес ws21: 
    ![Alt text](./screen/6.11.png)
- Принудительного освобождаем IP-адрес DHCP-клиента с помощью команды  `sudo dhclient -r`
- Получаем новый IP-адрес с помощью DHCP с помощью команды `sudo dhclient`
    ![Alt text](./screen/6.12.png)
- Через ip a показываем что адрес ws21 сменился:
    ![Alt text](./screen/6.13.png)
- Какими опциями DHCP сервера пользовались в данном пункте:
Настройка конфигурации службы DHCP (адрес маршрутизатора по-умолчанию, DNS-сервер, адрес внутренней сети, привязка к MAC-адресу)
Клиент протокола динамической конфигурации хоста (команда dhclient) для обновления или освобождения IP-адреса
---
## Part 7. NAT
- В файле /etc/apache2/ports.conf на ws22 изменяем строку Listen 80 на Listen 0.0.0.0:80
![Alt text](./screen/7.png)
- В файле /etc/apache2/ports.conf на и r1 изменяем строку Listen 80 на Listen 0.0.0.0:80
![Alt text](./screen/7.1.png)
- проверка что сервер работает на ws22
![Alt text](./screen/7.2.png)
- проверка что сервер работает на r1
![Alt text](./screen/7.3.png)
- Создаем на r2 файл /etc/firewall.sh, имитирующий фаерволл
- Добавляем в фаервол следующие правила:
![Alt text](./screen/7.4.png)
- Запускаем файл командами sudo chmod +x /etc/firewall.sh и sudo bash /etc/firewall.sh
![Alt text](./screen/7.5.png)
- Проверяем соединение между ws22 и r1 командой ping, ws22 не должна "пинговаться" с r1
![Alt text](./screen/7.6.png)
- Добавляем в фаервол следующие правила:
![Alt text](./screen/7.7.png)
- выключаем NAT
![Alt text](./screen/7.8.png)
- Запускаем файл командами sudo chmod +x /etc/firewall.sh и sudo bash /etc/firewall.sh
![Alt text](./screen/7.9.png)
- Проверить соединение по TCP для SNAT, для этого с ws22 подключаемся к серверу Apache на r1 командой: telnet 10.10.0.1 80
![Alt text](./screen/7.10.png)
- Проверяем соединение по TCP для DNAT, для этого с r1 подключаемся к серверу Apache на ws22 командой telnet 10.20.0.20 80
![Alt text](./screen/7.11.png)

## Part 8. Дополнительно. Знакомство с SSH Tunnels
- Запускаем файл командами sudo chmod +x /etc/firewall.sh и sudo bash /etc/firewall.sh
![Alt text](./screen/8.png)
- Запускаем веб-сервер Apache на ws22 только на localhost то есть в файле /etc/apache2/ports.conf меняем строку Listen 80 на Listen localhost:80
![Alt text](./screen/8.1.png)
- Воспользуемся Local TCP forwarding с ws21 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws21
![Alt text](./screen/8.2.png)
- Воспользуемся Remote TCP forwarding c ws11 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws11
![Alt text](./screen/8.3.png)
